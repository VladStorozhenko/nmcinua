<?php/** * === * Functions file * === *//* Enqueue file */require_once get_template_directory() . '/inc/enqueue.php';/* Register post types */require_once get_template_directory() . '/inc/custom_post_types.php';/* Register menu */register_nav_menus(	array(		'Основное меню' => "Основное меню"	));/* Add theme support for thumbnails */add_theme_support( 'post-thumbnails' );// AJAX call handling// handle select of typeadd_action( 'wp_ajax_nopriv_nmc_get_specialists_by_type', 'nmc_get_specialists_by_type' );add_action( 'wp_ajax_nmc_get_specialists_by_type', 'nmc_get_specialists_by_type' );function nmc_get_specialists_by_type() {	$type = $_POST['value'];	// Query Arguments	$args = array(		'post_type'        => 'specialist',		'post_status'      => 'publish',		'posts_per_page'   => - 1,		'suppress_filters' => '0',		'meta_query'       => array(			array(				'key'     => 'type_of_service',				'value'   => $type,				'compare' => 'LIKE'			)		)	);	// The Query	$ajaxposts = get_posts( $args );	$response  = '';	foreach ( $ajaxposts as $ajaxpost ) {		$work_days = get_field( 'work_days', $ajaxpost->ID );		$yes_days  = [];		foreach ( $work_days as $day ) {			$eng_day = '';			switch ( $day ) {				case 'понедельник':					$eng_day = 'monday';					array_push( $yes_days, 1 );					break;				case 'вторник':					$eng_day = 'tuesday';					array_push( $yes_days, 2 );					break;				case 'среда':					$eng_day = 'wednesday';					array_push( $yes_days, 3 );					break;				case 'четверг':					$eng_day = 'thursday';					array_push( $yes_days, 4 );					break;				case 'пятница':					$eng_day = 'friday';					array_push( $yes_days, 5 );					break;				case 'суббота':					$eng_day = 'saturday';					array_push( $yes_days, 6 );					break;				case 'воскресенье':					$eng_day = 'sunday';					array_push( $yes_days, 0 );					break;			}		}		$json = json_encode( $yes_days );		if ( in_array( 'понедельник', $work_days ) ) {			$monday_start_time       = get_field( 'start_work_time_monday', $ajaxpost->ID );			$monday_end_time         = get_field( 'end_work_time_monday', $ajaxpost->ID );			$only_preliminary_monday = get_field( 'only_preliminary_monday', $ajaxpost->ID );			if ( $only_preliminary_monday ) {				$prel = ' (по предварительной записи)';			} else {				$prel = '';			}			$monday_time = '<span class="time">' . $monday_start_time . ' - ' . $monday_end_time . '</span>' . $prel;		} else {			$monday_time = '';		}		if ( in_array( 'вторник', $work_days ) ) {			$tuesday_start_time       = get_field( 'start_work_time_tuesday', $ajaxpost->ID );			$tuesday_end_time         = get_field( 'end_work_time_tuesday', $ajaxpost->ID );			$only_preliminary_tuesday = get_field( 'only_preliminary_tuesday', $ajaxpost->ID );			if ( $only_preliminary_tuesday ) {				$prel = ' (по предварительной записи)';			} else {				$prel = '';			}			$tuesday_time = '<span class="time">' . $tuesday_start_time . ' - ' . $tuesday_end_time . '</span>' . $prel;		} else {			$tuesday_time = '';		}		if ( in_array( 'среда', $work_days ) ) {			$wednesday_start_time       = get_field( 'start_work_time_wednesday', $ajaxpost->ID );			$wednesday_end_time         = get_field( 'end_work_time_wednesday', $ajaxpost->ID );			$only_preliminary_wednesday = get_field( 'only_preliminary_wednesday', $ajaxpost->ID );			if ( $only_preliminary_wednesday ) {				$prel = ' (по предварительной записи)';			} else {				$prel = '';			}			$wednesday_time = '<span class="time">' . $wednesday_start_time . ' - ' . $wednesday_end_time . '</span>' . $prel;		} else {			$wednesday_time = '';		}		if ( in_array( 'четверг', $work_days ) ) {			$thursday_start_time       = get_field( 'start_work_time_thursday', $ajaxpost->ID );			$thursday_end_time         = get_field( 'end_work_time_thursday', $ajaxpost->ID );			$only_preliminary_thursday = get_field( 'only_preliminary_thursday', $ajaxpost->ID );			if ( $only_preliminary_thursday ) {				$prel = ' (по предварительной записи)';			} else {				$prel = '';			}			$thursday_time = '<span class="time">' . $thursday_start_time . ' - ' . $thursday_end_time . '</span>' . $prel;		} else {			$thursday_time = '';		}		if ( in_array( 'пятница', $work_days ) ) {			$friday_start_time       = get_field( 'start_work_time_friday', $ajaxpost->ID );			$friday_end_time         = get_field( 'end_work_time_friday', $ajaxpost->ID );			$only_preliminary_friday = get_field( 'only_preliminary_friday', $ajaxpost->ID );			if ( $only_preliminary_friday ) {				$prel = ' (по предварительной записи)';			} else {				$prel = '';			}			$friday_time = '<span class="time">' . $friday_start_time . ' - ' . $thursday_end_time . '</span>' . $prel;		} else {			$friday_time = '';		}		if ( in_array( 'суббота', $work_days ) ) {			$saturday_start_time       = get_field( 'start_work_time_saturday', $ajaxpost->ID );			$saturday_end_time         = get_field( 'end_work_time_saturday', $ajaxpost->ID );			$only_preliminary_saturday = get_field( 'only_preliminary_saturday', $ajaxpost->ID );			if ( $only_preliminary_saturday ) {				$prel = ' (по предварительной записи)';			} else {				$prel = '';			}			$saturday_time = '<span class="time">' . $saturday_start_time . ' - ' . $saturday_end_time . '</span>' . $prel;		} else {			$saturday_time = '';		}		if ( in_array( 'воскресенье', $work_days ) ) {			$sunday_start_time       = get_field( 'start_work_time_sunday', $ajaxpost->ID );			$sunday_end_time         = get_field( 'end_work_time_sunday', $ajaxpost->ID );			$only_preliminary_sunday = get_field( 'only_preliminary_sunday', $ajaxpost->ID );			if ( $only_preliminary_sunday ) {				$prel = ' (по предварительной записи)';			} else {				$prel = '';			}			$sunday_time = '<span class="time">' . $sunday_start_time . ' - ' . $sunday_end_time . '</span>' . $prel;		} else {			$sunday_time = '';		}		$button_text          = __( "Записаться", "nmc-theme" );		$disable_appointments = get_field( 'disable_appointments', $ajaxpost->ID );		if ( ! $disable_appointments ) {			$button = '<button class="button button-blue specialist-button" data-toggle="modal" id="specialist-modal-button" data-target="#speciliastModal" data-daysToEnable="' . $json . '" data-id="' . $ajaxpost->ID . '" data-specialist="' . $ajaxpost->post_title . '">' . $button_text . '</button>';		} else {			$button = '';		}		$specialist_post = get_field( 'specialist_list_page_text', $ajaxpost->ID );		$response .= '<div class="single-specialist">            <div class="specialist-info"><a href=' . get_permalink( $ajaxpost->ID ) . '><img src=' . get_the_post_thumbnail_url( $ajaxpost->ID ) . '></a>            <h1>' . $ajaxpost->post_title . '</h1>            <p class="post">' . $specialist_post . '</p>            ' . $button . '            </div>                <table>                    <tr>                        <th>Пн</th>                        <td><p>' . $monday_time . '</p></td>                    </tr>                    <tr>                        <th>Вт</th>                        <td><p>' . $tuesday_time . '</p></td>                    </tr>                    <tr>                        <th>Ср</th>                        <td><p>' . $wednesday_time . '</p></td>                    </tr>                    <tr>                        <th>Чт</th>                        <td><p>' . $thursday_time . '</p></td>                    </tr>                    <tr>                        <th>Пт</th>                        <td><p>' . $friday_time . '</p></td>                    </tr>                    <tr>                        <th>Сб</th>                        <td><p>' . $saturday_time . '</p></td>                    </tr>                    <tr>                        <th>' . __( "Вс", "nmc-theme" ) . '</th>                        <td><p>' . $sunday_time . '</p></td>                    </tr>                </table>            </div>            ';	}	echo $response;	exit; // leave ajax call}// add_li_class for wp_nav_menufunction add_additional_class_on_li( $classes, $item, $args ) {	if ( isset( $args->add_li_class ) ) {		$classes[] = $args->add_li_class;	}	return $classes;}add_filter( 'nav_menu_css_class', 'add_additional_class_on_li', 1, 3 );// handle standart formadd_action( 'wp_ajax_nopriv_nmc_standart_register_form', 'nmc_standart_register_form' );add_action( 'wp_ajax_nmc_standart_register_form', 'nmc_standart_register_form' );function nmc_standart_register_form() {	$name = wp_strip_all_tags( $_POST['name'] );	$tel  = wp_strip_all_tags( $_POST['tel'] );	$type = wp_strip_all_tags( $_POST['type'] );	$args = array(		'post_title'   => $name,		'post_content' => "$tel \n <br> Направление: $type",		'post_type'    => 'standart-form',		'post_status'  => 'publish'	);	$postID = wp_insert_post( $args );	echo $postID;	die();}// handle specialist formadd_action( 'wp_ajax_nopriv_nmc_specialist_register_form', 'nmc_specialist_register_form' );add_action( 'wp_ajax_nmc_specialist_register_form', 'nmc_specialist_register_form' );function nmc_specialist_register_form() {	$forSpecialistName  = wp_strip_all_tags( $_POST['forSpecialistName'] );	$forSpecialistTel   = wp_strip_all_tags( $_POST['forSpecialistTel'] );	$forSpecialistDate  = wp_strip_all_tags( $_POST['forSpecialistDate'] );	$selectedSpecialist = wp_strip_all_tags( $_POST['selectedSpecialist'] );	$args = array(		'post_title'   => $forSpecialistName,		'post_content' => $forSpecialistTel,		'post_date'    => $forSpecialistDate,		'post_type'    => 'specialist-form',		'post_status'  => 'publish'	);	$postID = wp_insert_post( $args );	echo $postID;	update_post_meta( $postID, '_specialist_form_date_value_key', $forSpecialistDate );	update_post_meta( $postID, '_specialist_form_specialist_value_key', $selectedSpecialist );	die();}